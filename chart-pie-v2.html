<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Data Khách Hàng</title>
  <link rel="stylesheet" href="media/sass/style.css">
  <script nonce="undefined" src="https://cdn.zingchart.com/zingchart.min.js"></script>
</head>

<body>
  <div class="container">
    <div id="myChart" class="chart--container">
      <a class="zc-ref" href="https://www.zingchart.com/">Powered by ZingChart</a>
    </div>
    <div class="flex">
      <div class="form__group">
        <label for="title">Title</label>
        <input type="text" id="title" class="form__control" />
      </div>
      <div class="form__group">
        <label for="data">Data</label>
        <input type="number" id="data" class="form__control" min="0" />
      </div>
      <div class="form__group" style="display: none;">
        <label for="data" style="display: none;">Border width</label>
        <input type="text" id="border-width" value="1px" hidden />
      </div>
      <div class="form__group--color">
        <label for="data">Color</label>
        <input type="color" id="color" />
      </div>
    </div>
    <button type="submit" id="submit" class="button button--gradientBlue">Gửi</button>
    <button type="submit" id="save" class="button button--gradientGreen">Lưu</button>
    <div class="list">
      <div class="list__title">
        <div>Title</div>
        <div>Data</div>
        <div>Color</div>
        <div>Action</div>
      </div>
      <div id="list__data"></div>
    </div>
  </div>
  <script>
    const dataValue = localStorage.getItem("dataPie2");
    if (!dataValue) {
      var chartConfig = {
        gui: {
          contextMenu: {
            backgroundColor: "#306EAA", // sets background for entire contextMenu
            button: {
              backgroundColor: "#2D66A4",
              lineColor: "#2D66A4",
              visible: true,
            },
            docked: true,
            gear: {
              alpha: 1,
              backgroundColor: "#2D66A4",
            },
            item: {
              backgroundColor: "#306EAA",
              borderColor: "#306EAA",
              borderWidth: "0px",
              color: "#fff",
              fontFamily: "Lato",
            },
            position: "right",
          },
        },
        graphset: [
          {
            type: "ring",
            backgroundColor: "#FBFCFE",
            title: {
              text: "Data Khách Hàng",
              fontColor: "#1E5D9E",
              fontFamily: "Lato",
              fontSize: "14px",
              padding: "15px",
            },
            subtitle: {
              text: "01/01/2022 - 30/11/2022",
              fontColor: "#777",
              fontFamily: "Lato",
              fontSize: "12px",
              padding: "5px",
            },
            legend: {
              adjustLayout: true,
              align: "center",
              backgroundColor: "#FBFCFE",
              borderWidth: "0px",
              item: {
                cursor: "pointer",
                fontColor: "#777",
                fontSize: "12px",
                offsetX: "-6px",
              },
              marker: {
                type: "circle",
                borderWidth: "0px",
                cursor: "pointer",
                size: 5,
              },
              mediaRules: [
                {
                  maxWidth: "500px",
                  visible: false,
                },
              ],
              toggleAction: "remove",
              verticalAlign: "bottom",
            },
            plot: {
              tooltip: {
                text: '<span style="color:%color">Data: %t</span><br><span style="color:%color">Khách hàng: %v</span>',
                anchor: "c",
                backgroundColor: "none",
                borderWidth: "0px",
                fontSize: "16px",
                mediaRules: [
                  {
                    maxWidth: "500px",
                    y: "54%",
                  },
                ],
                sticky: true,
                thousandsSeparator: ",",
                x: "50%",
                y: "50%",
              },
              valueBox: [
                {
                  type: "all",
                  text: "%t",
                  placement: "out",
                },
                {
                  type: "all",
                  text: "%npv%",
                  placement: "in",
                },
              ],
              animation: {
                effect: "ANIMATION_EXPAND_VERTICAL",
                sequence: "ANIMATION_BY_PLOT_AND_NODE",
              },
              backgroundColor: "#FBFCFE",
              borderWidth: "0px",
              hoverState: {
                cursor: "hand",
              },
              slice: "60%",
            },
            plotarea: {
              margin: "70px 0px 10px 0px",
              backgroundColor: "transparent",
              borderRadius: "10px",
              borderWidth: "0px",
            },
            scaleR: {
              refAngle: 270,
            },
            series: [
              {
                text: "Kangnam",
                values: [966],
                backgroundColor: "#00BAF2",
                lineColor: "#00BAF2",
                lineWidth: "1px",
                marker: {
                  backgroundColor: "#00BAF2",
                },
              },
              {
                text: "Paris",
                values: [838],
                backgroundColor: "#E80C60",
                lineColor: "#E80C60",
                lineWidth: "1px",
                marker: {
                  backgroundColor: "#E80C60",
                },
              },
              {
                text: "Hồng Hà",
                values: [357],
                backgroundColor: "#9B26AF",
                lineColor: "#9B26AF",
                lineWidth: "1px",
                marker: {
                  backgroundColor: "#9B26AF",
                },
              },
            ],
            noData: {
              text: "No Selection",
              alpha: 0.6,
              backgroundColor: "#20b2db",
              bold: true,
              fontSize: "18px",
              textAlpha: 0.9,
            },
          },
        ],
      };
    } else {
      var chartConfig = JSON.parse(dataValue);
    }

    let url = chartConfig.graphset[0].series;

    const renderListData = () => {
      let html = "";
      for (let i = 0; i < url.length; i++) {
        html += `
            <div class="list__group">
              <div class="list__control">
                <input type="text" class="title${i}" placeholder='${url[i].text}'>
              </div>
              <div class="list__control">
                <input type="number" class="data${i}" placeholder='${url[i].values}'>
              </div>
              <div class="list__control">
                <input type="color" class="color${i}" value="${url[i].backgroundColor}">
              </div>
              <div class="list__control">
                <button class="button button--gradientGreen button--icon remove remove--${i}" onClick='editData(${i})'><i class="icon-pencil-1"></i></button>
                <button class="button button--gradientRed button--icon remove remove--${i}" onClick='removeData(${i})'><i class="icon-trash"></i></button>
              </div>
            </div>
          `;
      }
      document.getElementById("list__data").insertAdjacentHTML("beforeend", html);
    };

    const addDataToList = () => {
      let html = "";
      for (let i = 0; i < url.length; i++) {
        html = `
            <div class="list__group">
              <div class="list__control">
                <input type="text" class="title${i}" placeholder='${url[i].text}'>
              </div>
              <div class="list__control">
                <input type="number" class="data${i}" placeholder='${url[i].values}'>
              </div>
              <div class="list__control">
                <input type="color" class="color${i}" value="${url[i].backgroundColor}">
              </div>
              <div class="list__control">
                <button class="button button--gradientGreen button--icon remove remove--${i}" onClick='editData(${i})'><i class="icon-pencil-1"></i></button>
                <button class="button button--gradientRed button--icon remove remove--${i}" onClick='removeData(${i})'><i class="icon-trash"></i></button>
              </div>
            </div>
          `;
      }
      document.getElementById("list__data").insertAdjacentHTML("beforeend", html);
    };

    const renderChart = () => {
      ZC.LICENSE = [
        "569d52cefae586f634c54f86dc99e6a9",
        "b55b025e438fa8a98e32482b5f768ff5",
      ];
      zingchart.render({
        id: "myChart",
        data: chartConfig,
        height: "100%",
        width: "100%",
      });
    };

    const editData = (id) => {
      const newTitle = document.getElementsByClassName(`title${id}`)[0].value;
      const newData = document.getElementsByClassName(`data${id}`)[0].value;
      const newColor = document.getElementsByClassName(`color${id}`)[0].value;
      console.log(chartConfig.graphset[0].series[id])
      if (newTitle) {
        chartConfig.graphset[0].series[id].text = newTitle;
      }
      if (newData) {
        chartConfig.graphset[0].series[id].values = [Number(newData)];
      }
      if (newColor) {
        chartConfig.graphset[0].series[id].backgroundColor = newColor;
        chartConfig.graphset[0].series[id].lineColor = newColor;
        chartConfig.graphset[0].series[id].marker.backgroundColor = newColor;
      }
      renderChart();
    }

    const removeData = (id) => {
      chartConfig.graphset[0].series = chartConfig.graphset[0].series.filter((item, index) => {
        return index !== id;
      });
      url = url.filter((item, index) => {
        return index !== id;
      });
      const container = document.getElementById("list__data");
      while (container.firstChild) {
        container.removeChild(container.firstChild);
      }
      renderChart();
      renderListData();
    };

    document.getElementById("submit").addEventListener("click", function () {
      const title = document.getElementById("title").value;
      const data = document.getElementById("data").value;
      const color = document.getElementById("color").value;
      const border = document.getElementById("border-width").value;

      const arr = {
        text: title,
        values: [Number(data)],
        backgroundColor: color,
        lineColor: color,
        lineWidth: border,
        marker: {
          backgroundColor: color,
        },
      };
      url.push(arr);
      renderChart();
      addDataToList();
    });

    document.getElementById("save").addEventListener("click", function () {
      const myJSON = JSON.stringify(chartConfig);
      localStorage.setItem("dataPie2", myJSON);
    });

    renderChart();
    renderListData();
  </script>
</body>

</html>